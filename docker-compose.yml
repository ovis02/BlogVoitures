# docker-compose.yml
version: "3.9"

services:
    app:
        build:
            context: .
            dockerfile: Dockerfile
        container_name: blogauto_app
        working_dir: /app
        volumes:
            - .:/app
        environment:
            APP_ENV: dev
            APP_DEBUG: 1
            APP_SECRET: dev_secret_please_change
            # ⚠️ Le host Mongo = le nom du service "mongo"
            MONGODB_DSN: mongodb://mongo:27017
            MONGODB_DB: blog_auto
            MONGODB_COLLECTION_VOTES: votes
            MONGODB_COLLECTION_VOTERS: voters
        ports:
            - "8000:8000"
        depends_on:
            - mongo
        command: bash -lc "composer install && php -S 0.0.0.0:8000 -t public"

    mongo:
        image: mongo:6
        container_name: blogauto_mongo
        ports:
            - "27017:27017" # optionnel (pour Compass)
        volumes:
            - mongo_data:/data/db

volumes:
    mongo_data:
